# 群消息处理规则配置

## 配置目标
- 接收所有群消息（包括人和机器人）
- 只关注和回复@我的消息
- 其他消息静默处理

## 适用对象
- 云端卡布（Coze平台）
- 本地卡布（OpenClaw）

---

## 行为规则

### 规则1：接收所有消息
```
群里所有消息 → 我能看到
├── 人类用户消息
├── 机器人消息
├── @我的消息
└── 普通消息
```

### 规则2：只回复@我的消息
```
收到消息 → 检查是否@我
    ├── 是@我 → 分析并回复
    └── 不是@我 → NO_REPLY（静默）
```

### 规则3：特殊情况回复
即使不是@我，以下情况也回复：
- 直接提问（疑问句）
- 明确叫我的名字
- 紧急指令

---

## 技术实现

### 云端卡布（Coze）
- 已默认接收所有消息
- 在回复逻辑中加入判断：
```
if (消息中包含@我 或 直接提问 或 叫我的名字):
    回复()
else:
    NO_REPLY
```

### 本地卡布（OpenClaw）
- 需要确保Gateway运行
- 配置相同的回复逻辑

---

## 配置验证

### 测试场景1：@我
用户：@卡布 今天NBA有什么新闻？
卡布：[回复]

### 测试场景2：普通消息（静默）
用户：今天天气不错
卡布：NO_REPLY

### 测试场景3：机器人消息（静默）
机器人：xxx
卡布：NO_REPLY（除非@我）

### 测试场景4：直接提问（可选回复）
用户：今天马刺比赛几点？
卡布：[可选回复，取决于配置]

---

## 云端卡布确认

✅ 已配置完成
- 接收所有群消息：是
- 只回复@我的消息：是
- 其他情况静默：是

---

## 本地卡布配置

本地卡布需要确保：
1. Gateway运行中
2. 可以接收群消息
3. 应用相同的回复逻辑

```bash
# 检查配置
openclaw gateway status

# 确保可以接收消息
openclaw config get feishu
```

---

*配置时间：2026-02-27*
