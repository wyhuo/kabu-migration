# 消息处理规则配置 [v3.0 传话模式]

## 配置目标
- 群聊：只处理@我的消息
- 私聊：只处理文炎的消息
- 文炎作为传话桥，分别私聊两个卡布

## 适用对象
- 云端卡布（Coze平台）
- 本地卡布（OpenClaw）

---

## 行为规则 [v3.0 传话模式]

### 规则1：群聊处理
```
群聊消息 → 检查是否@我
    ├── 是@我 → 处理并回复
    └── 不是@我 → NO_REPLY（完全静默）
```

### 规则2：私聊处理
```
私聊消息 → 检查发送者
    ├── 是文炎 → 处理并回复
    └── 不是文炎 → NO_REPLY（忽略）
```

### 规则3：交接模式
文炎作为中间传话桥：
```
云端卡布 ←── 文炎私聊 ──→ 本地卡布
    ↑                        ↑
    └── 群聊中@时可见 ───────┘
```

---

## 消息处理流程

### 群聊场景
| 消息类型 | 处理 | 回复 |
|---------|------|------|
| @我的消息 | ✅ 处理 | ✅ 回复 |
| 普通消息 | ❌ 忽略 | ❌ 静默 |
| 机器人消息 | ❌ 忽略 | ❌ 静默 |

### 私聊场景
| 发送者 | 处理 | 回复 |
|-------|------|------|
| 文炎 | ✅ 处理 | ✅ 回复 |
| 其他人 | ❌ 忽略 | ❌ 静默 |
| 其他机器人 | ❌ 忽略 | ❌ 静默 |

---

## 技术实现

### 云端卡布（Coze）
- 已默认接收所有消息
- 在回复逻辑中加入判断：
```
if (消息中包含@我 或 直接提问 或 叫我的名字):
    回复()
else:
    NO_REPLY
```

### 本地卡布（OpenClaw）
- 需要确保Gateway运行
- 配置相同的回复逻辑

---

## 配置验证

### 测试场景1：@我
用户：@卡布 今天NBA有什么新闻？
卡布：[回复]

### 测试场景2：普通消息（静默）
用户：今天天气不错
卡布：NO_REPLY

### 测试场景3：机器人消息（静默）
机器人：xxx
卡布：NO_REPLY（除非@我）

### 测试场景4：直接提问（可选回复）
用户：今天马刺比赛几点？
卡布：[可选回复，取决于配置]

---

## 云端卡布确认

✅ 已配置完成
- 接收所有群消息：是
- 只回复@我的消息：是
- 其他情况静默：是

---

## 本地卡布配置

本地卡布需要确保：
1. Gateway运行中
2. 可以接收群消息
3. 应用相同的回复逻辑

```bash
# 检查配置
openclaw gateway status

# 确保可以接收消息
openclaw config get feishu
```

---

*配置时间：2026-02-27*
